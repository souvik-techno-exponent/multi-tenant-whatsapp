# frontend/Dockerfile.dev
FROM node:18-bullseye-slim

# Install build tools needed by native modules
RUN apt-get update \
 && apt-get install -y --no-install-recommends build-essential python3 ca-certificates curl \
 && rm -rf /var/lib/apt/lists/*

WORKDIR /usr/src/app

# Copy package.json and lockfile first (leverage cache)
COPY package.json package-lock.json* ./

# Install deps during image build as root (avoids permission trouble)
RUN npm ci --ignore-scripts --no-audit --no-fund

# Create non-root node user and ensure ownership of the app directory
RUN useradd --user-group --uid 1000 node || true \
 && chown -R node:node /usr/src/app

# Switch to non-root user for runtime
USER node

# Expose dev port and default cmd for dev
EXPOSE 5173
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0", "--port", "5173"]
